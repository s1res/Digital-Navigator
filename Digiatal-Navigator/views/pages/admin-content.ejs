<%- include('../partials/header', { title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º', page: 'admin-content' }) %>

  <main>
    <section class="page-header">
      <div class="container">
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</h1>
        <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π, —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏ –º–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
      </div>
    </section>

    <section class="admin-section">
      <div class="container">
        <% if (typeof query !== 'undefined' && query.success) { %>
          <div class="success-message">
            <% if (query.success === 'leader_created') { %>
              <p>‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</p>
            <% } else if (query.success === 'leader_updated') { %>
              <p>‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</p>
            <% } else if (query.success === 'leader_deleted') { %>
              <p>‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!</p>
            <% } else if (query.success === 'project_created') { %>
              <p>‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</p>
            <% } else if (query.success === 'project_updated') { %>
              <p>‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</p>
            <% } else if (query.success === 'project_deleted') { %>
              <p>‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!</p>
            <% } else if (query.success === 'event_created' || query.success === 'created') { %>
              <p>‚úÖ –°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!</p>
            <% } else if (query.success === 'event_updated' || query.success === 'updated') { %>
              <p>‚úÖ –°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!</p>
            <% } else if (query.success === 'event_deleted' || query.success === 'deleted') { %>
              <p>‚úÖ –°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!</p>
            <% } %>
          </div>
        <% } %>
        <% if (typeof query !== 'undefined' && query.error) { %>
          <div class="error-message">
            <p>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
          </div>
        <% } %>

        <div style="margin-bottom: 2rem; text-align: right;">
          <a href="/admin" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
        </div>

        <!-- –°–æ–±—ã—Ç–∏—è -->
        <div class="content-management-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –°–æ–±—ã—Ç–∏–π</h2>
            <a href="/admin/content/events/new" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</a>
          </div>

          <div class="events-management-table">
            <% if (typeof events !== 'undefined' && events && events.length > 0) { %>
              <table>
                <thead>
                  <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody>
                  <% events.forEach(function(event) { %>
                    <% 
                      const eventDate = new Date(event.event_date);
                      const formattedDate = eventDate.toLocaleDateString('ru-RU', { 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric' 
                      });
                    %>
                    <tr>
                      <td><strong><%= formattedDate %></strong></td>
                      <td><%= event.event_time || '-' %></td>
                      <td><strong><%= event.title %></strong></td>
                      <td><%= event.description ? (event.description.length > 50 ? event.description.substring(0, 50) + '...' : event.description) : '-' %></td>
                      <td><%= event.location || '-' %></td>
                      <td>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                          <a href="/admin/event-registrations/<%= event.id %>" class="btn btn-secondary btn-small" style="background-color: #17a2b8; border-color: #17a2b8;" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏">
                            üë• –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                          </a>
                          <a href="/admin/content/events/<%= event.id %>/edit" class="btn btn-primary btn-small">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                          <form action="/admin/content/events/<%= event.id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?');">
                            <button type="submit" class="btn btn-secondary btn-small" style="background-color: #dc3545; border-color: #dc3545;">–£–¥–∞–ª–∏—Ç—å</button>
                          </form>
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            <% } else { %>
              <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                <p>–°–æ–±—ã—Ç–∏—è –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                <a href="/admin/content/events/new" class="btn btn-primary" style="margin-top: 1rem;">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</a>
              </div>
            <% } %>
          </div>
        </div>

        <!-- –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ -->
        <div class="content-management-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ –û—Ç–¥–µ–ª–µ–Ω–∏—è</h2>
            <a href="/admin/content/leaders/new" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</a>
          </div>

          <div class="leaders-management-grid">
            <% if (typeof leaders !== 'undefined' && leaders && leaders.length > 0) { %>
              <% leaders.forEach(function(leader) { %>
                <div class="leader-management-card">
                  <div class="leader-avatar-large"><%= leader.avatar || 'üë§' %></div>
                  <h3><%= leader.name %></h3>
                  <p class="leader-role"><%= leader.role %></p>
                  <% if (leader.bio) { %>
                    <p class="leader-bio"><%= leader.bio %></p>
                  <% } %>
                  <div class="leader-actions">
                    <a href="/admin/content/leaders/<%= leader.id %>/edit" class="btn btn-primary btn-small">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <form action="/admin/content/leaders/<%= leader.id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è?');">
                      <button type="submit" class="btn btn-secondary btn-small" style="background-color: #dc3545; border-color: #dc3545;">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <div style="text-align: center; padding: 2rem; color: var(--text-light); grid-column: 1 / -1;">
                <p>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                <a href="/admin/content/leaders/new" class="btn btn-primary" style="margin-top: 1rem;">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</a>
              </div>
            <% } %>
          </div>
        </div>

        <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
        <div class="content-management-section" style="margin-top: 3rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>–ú–µ—Å—Ç–Ω—ã–µ –ü—Ä–æ–µ–∫—Ç—ã</h2>
            <a href="/admin/content/projects/new" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</a>
          </div>

          <div class="projects-management-list">
            <% if (typeof projects !== 'undefined' && projects && projects.length > 0) { %>
              <% projects.forEach(function(project) { %>
                <div class="project-management-card">
                  <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                    <div style="flex: 1;">
                      <h4><%= project.icon ? project.icon + ' ' : '' %><%= project.title %></h4>
                      <p><%= project.description %></p>
                    </div>
                    <div class="project-actions">
                      <a href="/admin/content/projects/<%= project.id %>/edit" class="btn btn-primary btn-small">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                      <form action="/admin/content/projects/<%= project.id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç?');">
                        <button type="submit" class="btn btn-secondary btn-small" style="background-color: #dc3545; border-color: #dc3545;">–£–¥–∞–ª–∏—Ç—å</button>
                      </form>
                    </div>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                <p>–ü—Ä–æ–µ–∫—Ç—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                <a href="/admin/content/projects/new" class="btn btn-primary" style="margin-top: 1rem;">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç</a>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </section>
  </main>

<%- include('../partials/footer') %>
